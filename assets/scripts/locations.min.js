!function($,window,document){"use strict";var getLastSiblingInRow=function(element){for(var candidate=element,elementTop=element.offsetTop;null!==candidate.nextElementSibling;){if(candidate.nextElementSibling.offsetTop>elementTop)return candidate;candidate=candidate.nextElementSibling}return candidate},calculatePageScrollDistance=function(top,bottom){var scrollDistanceToTop,scrollDistanceToBottom,windowScrollDistance=$(window).scrollTop(),windowHeight=$(window).height();return windowScrollDistance>=top?top-windowScrollDistance:windowScrollDistance+windowHeight>=bottom?0:(scrollDistanceToTop=top-windowScrollDistance,scrollDistanceToBottom=bottom-(windowScrollDistance+windowHeight),Math.min(scrollDistanceToTop,scrollDistanceToBottom))},expandingGrid=function(context,options){var defaults={animationDuration:100,linksSelector:".links a.more",expandingAreaSelector:".expanding-container",closeButtonMarkup:'<a href="#" class="close-button">Close</a>',spacerMarkup:'<span class="spacer" aria-hidden="true"/>',elementActiveClass:"active",elementExpandedClass:"expanded",onExpandBefore:!1,onExpandAfter:!1},settings=$.extend({},defaults,options),isExpanded=!1,activeLink=!1,activeExpandedArea=!1,activeExpandedAreaTop=!1,activeExpandedAreaHeight=!1,lastItemInActiveRow=!1,activeRowChanged=!1,checkExpandedAreaResize=!1,$links=$(settings.linksSelector,context),$expandingAreas=$(settings.expandingAreaSelector,context),$closeButton=$(settings.closeButtonMarkup),$spacer=$(settings.spacerMarkup),$secondarySpacer=$spacer.clone(),scrollSectionIntoView=function(top,bottom,duration,callback){var animate,timeLeft,scroll=0,distance=calculatePageScrollDistance(top,bottom),windowScrollDistance=$(window).scrollTop();duration=void 0===duration?settings.animationDuration:duration,timeLeft=duration;var start=(new Date).getTime(),last=start,tick=function(){var x=0===(timeLeft=Math.max(duration-(new Date-start),0))||0===distance?0:(new Date-last)/timeLeft*distance,diff=distance>0?Math.min(x,distance):Math.max(x,distance);distance-=diff,scroll+=diff,window.scrollTo(0,windowScrollDistance+scroll),(last=(new Date).getTime())-start<=duration?animate=window.requestAnimationFrame&&requestAnimationFrame(tick)||setTimeout(tick,16):"function"==typeof callback&&callback()};tick()};$links.each(function(){var $this=$(this),targetId=$this.attr("href").match(/#([^\?]+)/)[1],target=document.getElementById(targetId);target&&$this.click(function(event){var scrollTargetOffset,closeButtonAnimationDelay,clickedLink=this;event.preventDefault(),isExpanded&&activeLink===clickedLink?$closeButton.click():($links.removeClass(settings.elementActiveClass).filter($this).addClass(settings.elementActiveClass).parents("li").each(function(){var lastSibling=getLastSiblingInRow(this);(activeRowChanged=lastSibling!==lastItemInActiveRow)&&(lastItemInActiveRow=lastSibling),isExpanded&&activeRowChanged&&($secondarySpacer.height($spacer.height()),$spacer.height(0).replaceWith($secondarySpacer)),$(lastItemInActiveRow).after($spacer)}),isExpanded&&activeRowChanged&&($secondarySpacer.animate({height:0},settings.animationDuration,function(){$(this).detach()}),$closeButton.removeClass(settings.elementActiveClass).hide()),scrollTargetOffset=$secondarySpacer.position().top<$spacer.position().top?$secondarySpacer.height():0,activeExpandedAreaTop=$spacer.position().top-scrollTargetOffset,$expandingAreas.removeClass(settings.elementExpandedClass).hide().filter(target).each(function(){var $this=$(this),autoHeight=$this.height(),autoOuterHeight=$this.outerHeight(),initialHeight=isExpanded&&activeExpandedAreaHeight&&!1===activeRowChanged?activeExpandedAreaHeight:0;stopExpandedAreaMonitor(),$spacer.animate({height:autoHeight+"px"},settings.animationDuration),$this.css({height:initialHeight+"px",position:"absolute",left:0,top:$spacer.position().top+"px"}).show(0,function(){"function"==typeof settings.onExpandBefore&&settings.onExpandBefore.call(this)}).animate({height:autoHeight+"px",top:activeExpandedAreaTop+"px"},settings.animationDuration,function(){$this.css({height:"auto"}).addClass(settings.elementExpandedClass),activeExpandedAreaHeight=$this.height(),checkExpandedAreaResize=setInterval(function(){var activeExpandedAreaNewHeight=$this.height();activeExpandedAreaNewHeight!==activeExpandedAreaHeight&&(activeExpandedAreaHeight=activeExpandedAreaNewHeight,syncExpandedAreaWithSpacer())},settings.animationDuration),"function"==typeof settings.onExpandAfter&&settings.onExpandAfter.call(this)});var scrollTargetTop=$(clickedLink).offset().top-scrollTargetOffset,scrollTargetBottom=$this.offset().top+autoOuterHeight+20-scrollTargetOffset;scrollSectionIntoView(scrollTargetTop,scrollTargetBottom)}),closeButtonAnimationDelay=isExpanded&&activeRowChanged&&$this.parent().index()>$(activeLink).parent().index()?settings.animationDuration:settings.animationDuration/4,$closeButton.css({position:"absolute",top:activeExpandedAreaTop+"px"}).delay(closeButtonAnimationDelay).fadeIn(settings.animationDuration,function(){$(this).addClass(settings.elementActiveClass)}),activeLink=this,activeExpandedArea=target,isExpanded=!0)})}),$closeButton.appendTo(context).hide().click(function(event){var $activeLink=$(activeLink),activeLinkTopOffset=$activeLink.offset().top,activeLinkBottomOffset=activeLinkTopOffset+$activeLink.outerHeight();event.preventDefault(),$links.removeClass(settings.elementActiveClass),$expandingAreas.slideUp(settings.animationDuration).removeClass(settings.elementExpandedClass),$closeButton.removeClass("active").hide(),$spacer.animate({height:0},settings.animationDuration,function(){$spacer.detach()}),scrollSectionIntoView(activeLinkTopOffset,activeLinkBottomOffset),stopExpandedAreaMonitor(),isExpanded=!1,activeLink=!1,activeExpandedArea=!1});var stopExpandedAreaMonitor=function(){checkExpandedAreaResize&&clearInterval(checkExpandedAreaResize)},syncExpandedAreaWithSpacer=function(){activeExpandedArea&&isExpanded&&($spacer.height($(activeExpandedArea).height()),activeExpandedAreaTop=$spacer.position().top,$closeButton.add(activeExpandedArea).css({top:activeExpandedAreaTop+"px"}))},positionSpacer=function(){var lastSibling;activeLink&&lastItemInActiveRow&&isExpanded&&($spacer.detach(),lastSibling=getLastSiblingInRow($(activeLink).parents("li")[0]),lastItemInActiveRow!==lastSibling&&(console.log(lastSibling),lastItemInActiveRow=lastSibling),$(lastItemInActiveRow).after($spacer))};$(window).resize(function(){isExpanded&&(positionSpacer(),syncExpandedAreaWithSpacer())})};$.fn.expandingGrid=function(options){return this.each(function(){expandingGrid(this,options)})}}(jQuery,window,document),function($){"use strict";$(document).ready(function(){$(".expanding-grid").expandingGrid()})}(jQuery);